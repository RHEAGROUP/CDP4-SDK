image: Visual Studio 2017
environment:
  DOTNET_CLI_TELEMETRY_OPTOUT: true
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
for:
# configuration for "master" branch, build in Release mode
-
  branches:
    only:
      - master
  configuration: Release
# configuration for "development" branch, build in Dev mode
-
  branches:
    only:
      - development
  configuration: Dev
# "fall back" configuration for all other branches
# no "branches" section defined
configuration: Debug
before_build:
  - cmd: nuget install NUnit.Console -Version 3.9.0 -OutputDirectory tools
  - cmd: nuget restore
  - cmd: choco install opencover.portable
  - cmd: choco install codecov
build:
  project: CDP4-SDK.sln
test:
  assemblies:
    only:
      - '**\bin\$(configuration)\net472\*.Tests.dll'
      - '**\bin\$(configuration)\netstandard1.6\*.Tests.dll'
      - '**\bin\$(configuration)\netstandard2.0\*.Tests.dll'
  categories:
    except:
      - WebServicesDependent
      - AppVeyorExclusion
after_test:
  - OpenCover.Console.exe -register:user -target:"C:/Program Files/dotnet/dotnet.exe" -targetargs:"test --filter \"TestCategory!=WebServicesDependent&TestCategory!=AppVeyorExclusion\"" -filter:"-[*.Tests*]*" -output:".\cdp4sdk_coverage.xml" -oldstyle -log:Error
  - codecov -f "cdp4sdk_coverage.xml" -t b8924a0f-355e-4a9a-b304-f403231a6bcb